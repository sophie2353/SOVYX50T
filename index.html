<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sovyx - Sistema High Ticket</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 20px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #2c3e50 0%, #4a235a 100%);
      color: white;
      padding: 30px 40px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 2.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .header .subtitle {
      color: #ecf0f1;
      margin-top: 10px;
      font-size: 1.1em;
    }
    
    .content {
      display: grid;
      grid-template-columns: 300px 1fr;
      min-height: 800px;
    }
    
    .sidebar {
      background: #f8f9fa;
      padding: 30px;
      border-right: 1px solid #e0e0e0;
    }
    
    .main {
      padding: 30px;
    }
    
    .client-selector {
      margin-bottom: 30px;
    }
    
    .client-selector h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .client-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .client-btn {
      padding: 15px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
    }
    
    .client-btn:hover {
      border-color: #3498db;
      transform: translateX(5px);
    }
    
    .client-btn.active {
      border-color: #2ecc71;
      background: #eafaf1;
      font-weight: bold;
    }
    
    .client-btn.owner {
      border-color: #f39c12;
      background: #fef9e7;
    }
    
    .section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      border: 1px solid #e0e0e0;
    }
    
    .section h2 {
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #34495e;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border 0.3s;
      box-sizing: border-box;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    textarea {
      min-height: 120px;
      resize: vertical;
      font-family: inherit;
    }
    
    .file-upload {
      border: 2px dashed #3498db;
      border-radius: 10px;
      padding: 40px 20px;
      text-align: center;
      background: #f8fafc;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .file-upload:hover {
      background: #ebf5fb;
      border-color: #2980b9;
    }
    
    .file-upload input {
      display: none;
    }
    
    .file-upload-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      color: #3498db;
      font-weight: 600;
      font-size: 1.1em;
    }
    
    .preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .preview-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .preview-item img, .preview-item video {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    
    .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .multi-select {
      height: 150px;
      overflow-y: auto;
    }
    
    .multi-select option {
      padding: 10px;
      margin: 2px 0;
      border-radius: 5px;
    }
    
    .multi-select option:checked {
      background: #3498db linear-gradient(0deg, #3498db 0%, #3498db 100%);
      color: white;
    }
    
    .range-container {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .range-container input[type="range"] {
      flex: 1;
    }
    
    .range-container input[type="number"] {
      width: 80px;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }
    
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
    }
    
    .btn-secondary {
      background: #f8f9fa;
      color: #495057;
      border: 2px solid #e0e0e0;
    }
    
    .btn-secondary:hover {
      background: #e9ecef;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
      color: white;
    }
    
    .results {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-top: 30px;
    }
    
    .results h3 {
      margin-top: 0;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #output {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }
    
    .status {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
    
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #17a2b8;
    }
    
    .status.warning {
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffc107;
    }
    
    .campaign-summary {
      background: linear-gradient(135deg, #e8f4fc 0%, #d4e6f1 100%);
      border-left: 5px solid #3498db;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .summary-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .summary-item .label {
      font-size: 12px;
      color: #7f8c8d;
      text-transform: uppercase;
      margin-bottom: 5px;
    }
    
    .summary-item .value {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
    }
    
    .help-text {
      font-size: 12px;
      color: #7f8c8d;
      margin-top: 5px;
      font-style: italic;
    }
    
    .tab-container {
      display: flex;
      border-bottom: 2px solid #e0e0e0;
      margin-bottom: 25px;
    }
    
    .tab {
      padding: 12px 25px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      color: #6c757d;
      transition: all 0.3s;
    }
    
    .tab.active {
      color: #3498db;
      border-bottom-color: #3498db;
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @media (max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üöÄ Sovyx High Ticket System</h1>
      <p class="subtitle">Publica en Instagram + Distribuye a 100,000 high ticket en 24h</p>
    </div>
    
    <div class="content">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="client-selector">
          <h3>üë• Seleccionar Cliente</h3>
          <div class="client-buttons">
            <button class="client-btn owner active" onclick="selectClient('owner')">
              <span style="font-size: 20px;">üëë</span>
              <div>
                <div>Owner</div>
                <small style="font-weight: normal; color: #7f8c8d;">Cuenta principal</small>
              </div>
            </button>
            <button class="client-btn" onclick="selectClient('client1')">
              <span style="font-size: 20px;">üë§</span>
              <div>
                <div>Cliente 1</div>
                <small style="font-weight: normal; color: #7f8c8d;">Por configurar</small>
              </div>
            </button>
            <button class="client-btn" onclick="selectClient('client2')">
              <span style="font-size: 20px;">üë§</span>
              <div>
                <div>Cliente 2</div>
                <small style="font-weight: normal; color: #7f8c8d;">Por configurar</small>
              </div>
            </button>
            <button class="client-btn" onclick="selectClient('client3')">
              <span style="font-size: 20px;">üë§</span>
              <div>
                <div>Cliente 3</div>
                <small style="font-weight: normal; color: #7f8c8d;">Por configurar</small>
              </div>
            </button>
            <button class="client-btn" onclick="selectClient('client4')">
              <span style="font-size: 20px;">üë§</span>
              <div>
                <div>Cliente 4</div>
                <small style="font-weight: normal; color: #7f8c8d;">Por configurar</small>
              </div>
            </button>
            <button class="client-btn" onclick="selectClient('client5')">
              <span style="font-size: 20px;">üë§</span>
              <div>
                <div>Cliente 5</div>
                <small style="font-weight: normal; color: #7f8c8d;">Por configurar</small>
              </div>
            </button>
          </div>
        </div>
        
        <div class="section">
          <h3>üìä Cliente Actual</h3>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <div style="font-weight: bold; color: #3498db;" id="currentClientDisplay">Owner</div>
            <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;" id="clientTypeDisplay">Cuenta principal</div>
          </div>
          <button class="btn btn-secondary" onclick="refreshToken()" style="margin-top: 15px; width: 100%;">
            üîÑ Refrescar Token
          </button>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="main">
        <!-- Tabs -->
        <div class="tab-container">
          <div class="tab active" onclick="switchTab('upload')">üì§ Subir Contenido</div>
          <div class="tab" onclick="switchTab('config')">üéØ Configurar Campa√±a</div>
          <div class="tab" onclick="switchTab('results')">üìä Resultados</div>
        </div>
        
        <!-- Tab 1: Subir Contenido -->
        <div id="upload-tab" class="tab-content active">
          <div class="section">
            <h2>üì§ Subir Contenido para Instagram</h2>
            
            <div class="form-group">
              <label for="mediaUpload">üìÅ Seleccionar archivos:</label>
              <div class="file-upload" onclick="document.getElementById('mediaUpload').click()">
                <div class="file-upload-label">
                  <span style="font-size: 40px;">üìé</span>
                  <div>Haz clic para seleccionar fotos/videos</div>
                  <div style="font-size: 14px; color: #7f8c8d;">M√°ximo 10 archivos ‚Ä¢ 100MB cada uno</div>
                  <div style="font-size: 14px; color: #7f8c8d;">Formatos: JPEG, PNG, GIF, MP4, MOV</div>
                </div>
              </div>
              <input type="file" id="mediaUpload" accept="image/*,video/*" multiple style="display: none;">
              <div class="help-text">Puedes seleccionar m√∫ltiples archivos para crear un carousel</div>
            </div>
            
            <div id="previewContainer" class="preview-container" style="display: none;">
              <!-- Preview items se agregar√°n aqu√≠ -->
            </div>
            
            <div class="form-group">
              <label for="postCaption">üìù Caption (descripci√≥n):</label>
              <textarea id="postCaption" placeholder="Escribe el caption para Instagram... 
Puedes usar emojis y hashtags.
M√°ximo 2200 caracteres."></textarea>
              <div class="help-text" id="charCount">0/2200 caracteres</div>
            </div>
            
            <div class="form-group">
              <label for="sessionId">üÜî ID de Sesi√≥n (opcional):</label>
              <input type="text" id="sessionId" placeholder="sess_123 o d√©jalo en blanco">
              <div class="help-text">Si no proporcionas un ID, se generar√° autom√°ticamente</div>
            </div>
            
            <div class="action-buttons">
              <button class="btn btn-primary" onclick="uploadContent()">
                üì§ Subir Contenido al Backend
              </button>
              <button class="btn btn-secondary" onclick="clearUpload()">
                üóëÔ∏è Limpiar
              </button>
            </div>
            
            <div id="uploadStatus"></div>
          </div>
        </div>
        
        <!-- Tab 2: Configurar Campa√±a -->
        <div id="config-tab" class="tab-content">
          <div class="section">
            <h2>üéØ Configurar Campa√±a High Ticket</h2>
            
            <div class="form-group">
              <label for="uploadId">üì¶ Contenido Subido:</label>
              <input type="text" id="uploadId" placeholder="Primero sube contenido en la pesta√±a anterior" readonly>
              <div class="help-text" id="uploadInfo"></div>
            </div>
            
            <div class="form-group">
              <label for="windowHours">‚è∞ Duraci√≥n de la campa√±a:</label>
              <select id="windowHours">
                <option value="24">24 horas (recomendado)</option>
                <option value="12">12 horas (r√°pido)</option>
                <option value="48">48 horas (extendido)</option>
                <option value="72">72 horas (largo plazo)</option>
              </select>
              <div class="help-text">Tiempo para alcanzar el objetivo de alcance</div>
            </div>
            
            <div class="form-group">
              <label for="objetivo">üéØ Objetivo de Ventas:</label>
              <select id="objetivo">
                <option value="5">5 ventas (prueba)</option>
                <option value="10">10 ventas</option>
                <option value="25">25 ventas</option>
                <option value="50">50 ventas</option>
                <option value="100">100 ventas</option>
              </select>
            </div>
            
            <h3 style="margin-top: 30px; color: #2c3e50;">üåç Segmentaci√≥n High Ticket</h3>
            
            <div class="form-group">
              <label for="geo">üìç Regi√≥n Geogr√°fica:</label>
              <select id="geo" multiple class="multi-select">
                <option value="LATAM" selected>Am√©rica Latina (LATAM)</option>
                <option value="EUROPA" selected>Europa</option>
                <option value="USA">Estados Unidos</option>
                <option value="CANADA">Canad√°</option>
                <option value="MEXICO">M√©xico</option>
                <option value="ARGENTINA">Argentina</option>
                <option value="COLOMBIA">Colombia</option>
                <option value="CHILE">Chile</option>
                <option value="ESPA√ëA">Espa√±a</option>
              </select>
              <div class="help-text">Mant√©n Ctrl (Cmd en Mac) para seleccionar m√∫ltiples</div>
            </div>
            
            <div class="form-group">
              <label for="businessType">üè¢ Tipo de Negocio (High Ticket):</label>
              <select id="businessType" multiple class="multi-select">
                <option value="emprendedores" selected>Emprendedores</option>
                <option value="consultores" selected>Consultores</option>
                <option value="coaches" selected>Coaches</option>
                <option value="inversores">Inversores</option>
                <option value="profesionales">Profesionales</option>
                <option value="agencias">Agencias</option>
                <option value="creadores_contenido">Creadores de Contenido</option>
                <option value="fitness_influencers">Influencers Fitness</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>üë• Rango de Edad:</label>
              <div class="range-container">
                <input type="range" id="ageMinRange" min="18" max="65" value="28">
                <input type="number" id="ageMin" min="18" max="65" value="28">
                <span>a</span>
                <input type="range" id="ageMaxRange" min="25" max="75" value="55">
                <input type="number" id="ageMax" min="25" max="75" value="55">
              </div>
              <div class="help-text">Audiencia high ticket: 28-55 a√±os</div>
            </div>
            
            <div class="form-group">
              <label for="ticketMin">üí∞ Ticket M√≠nimo (USD):</label>
              <input type="number" id="ticketMin" value="2000" min="100" max="10000">
              <div class="help-text">Valor m√≠nimo del producto/servicio</div>
            </div>
            
            <div class="form-group">
              <label for="ticketMax">üí∞ Ticket M√°ximo (USD):</label>
              <input type="number" id="ticketMax" value="20000" min="1000" max="50000">
            </div>
            
            <div class="action-buttons">
              <button class="btn btn-success" onclick="crearCampanhaUnificada()">
                üöÄ CREAR CAMPA√ëA COMPLETA
              </button>
            </div>
            
            <div id="campaignStatus"></div>
          </div>
        </div>
        
        <!-- Tab 3: Resultados -->
        <div id="results-tab" class="tab-content">
          <div class="section">
            <h2>üìä Resultados de la Campa√±a</h2>
            
            <div id="campaignStatusMessage"></div>
            
            <div id="campaignSummary"></div>
            
            <h3>üìã Detalles T√©cnicos:</h3>
            <pre id="output">Esperando resultados de la campa√±a...</pre>
            
            <div class="action-buttons">
              <button class="btn btn-secondary" onclick="checkCampaignStatus()">
                üîÑ Actualizar Estado
              </button>
              <button class="btn btn-primary" onclick="switchTab('upload')">
                üì§ Crear Nueva Campa√±a
              </button>
            </div>
          </div>
        </div>
        
        <!-- Status Messages -->
        <div id="statusMessages"></div>
      </div>
    </div>
  </div>

  <script>
    // Configuraci√≥n
    const API_BASE = "https://sovyx-ia.vercel.app";
    let currentClient = 'owner';
    let uploadedFiles = [];
    let currentUploadId = null;
    let currentSessionId = null;
    let currentCampaignId = null;

    // ========== FUNCIONES PRINCIPALES ==========

    // Seleccionar cliente
    function selectClient(client) {
      currentClient = client;
      
      // Actualizar botones
      document.querySelectorAll('.client-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`.client-btn[onclick*="${client}"]`).classList.add('active');
      
      // Actualizar display
      const displayName = client === 'owner' ? 'Owner (Cuenta Principal)' : `Cliente ${client.charAt(client.length-1)}`;
      const displayType = client === 'owner' ? 'Cuenta principal con acceso completo' : 'Cuenta cliente configurable';
      
      document.getElementById('currentClientDisplay').textContent = displayName;
      document.getElementById('clientTypeDisplay').textContent = displayType;
      
      showStatus(`‚úÖ Cliente cambiado a: ${displayName}`, 'success');
    }

    // Cambiar entre tabs
    function switchTab(tabName) {
      // Ocultar todos los tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remover clase active de todos los tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Mostrar tab seleccionado
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      // Activar tab en la navegaci√≥n
      document.querySelector(`.tab[onclick*="${tabName}"]`).classList.add('active');
      
      // Si vamos a resultados y hay campa√±a, cargar estado
      if (tabName === 'results' && currentCampaignId) {
        checkCampaignStatus();
      }
    }

    // Mostrar mensajes de estado
    function showStatus(message, type = 'info', duration = 5000) {
      const statusDiv = document.getElementById('statusMessages');
      const icon = {
        'success': '‚úÖ',
        'error': '‚ùå',
        'warning': '‚ö†Ô∏è',
        'info': '‚ÑπÔ∏è'
      }[type] || '‚ÑπÔ∏è';
      
      const statusElement = document.createElement('div');
      statusElement.className = `status ${type}`;
      statusElement.innerHTML = `${icon} ${message}`;
      
      statusDiv.insertBefore(statusElement, statusDiv.firstChild);
      
      // Auto-remover despu√©s de un tiempo
      if (duration > 0) {
        setTimeout(() => {
          if (statusElement.parentNode) {
            statusElement.remove();
          }
        }, duration);
      }
      
      return statusElement;
    }

    // Contador de caracteres para caption
    document.getElementById('postCaption').addEventListener('input', function() {
      const charCount = this.value.length;
      document.getElementById('charCount').textContent = `${charCount}/2200 caracteres`;
      
      if (charCount > 2200) {
        document.getElementById('charCount').style.color = '#e74c3c';
      } else if (charCount > 2000) {
        document.getElementById('charCount').style.color = '#f39c12';
      } else {
        document.getElementById('charCount').style.color = '#7f8c8d';
      }
    });

    // Sincronizar sliders de edad
    document.getElementById('ageMinRange').addEventListener('input', function() {
      document.getElementById('ageMin').value = this.value;
    });
    
    document.getElementById('ageMin').addEventListener('input', function() {
      document.getElementById('ageMinRange').value = this.value;
    });
    
    document.getElementById('ageMaxRange').addEventListener('input', function() {
      document.getElementById('ageMax').value = this.value;
    });
    
    document.getElementById('ageMax').addEventListener('input', function() {
      document.getElementById('ageMaxRange').value = this.value;
    });

    // Manejar selecci√≥n de archivos
    document.getElementById('mediaUpload').addEventListener('change', function(e) {
      uploadedFiles = Array.from(e.target.files);
      updatePreview();
    });

    // Actualizar previsualizaci√≥n de archivos
    function updatePreview() {
      const previewContainer = document.getElementById('previewContainer');
      
      if (uploadedFiles.length === 0) {
        previewContainer.style.display = 'none';
        previewContainer.innerHTML = '';
        return;
      }
      
      previewContainer.style.display = 'grid';
      previewContainer.innerHTML = '';
      
      uploadedFiles.forEach((file, index) => {
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';
        
        if (file.type.startsWith('image/')) {
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          previewItem.appendChild(img);
        } else if (file.type.startsWith('video/')) {
          const video = document.createElement('video');
          video.src = URL.createObjectURL(file);
          video.controls = true;
          previewItem.appendChild(video);
        }
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.innerHTML = '√ó';
        removeBtn.onclick = () => removeFile(index);
        
        previewItem.appendChild(removeBtn);
        previewContainer.appendChild(previewItem);
      });
      
      showStatus(`üìÅ ${uploadedFiles.length} archivo(s) seleccionado(s)`, 'info');
    }

    // Remover archivo
    function removeFile(index) {
      uploadedFiles.splice(index, 1);
      document.getElementById('mediaUpload').value = '';
      updatePreview();
    }

    // Limpiar upload
    function clearUpload() {
      uploadedFiles = [];
      document.getElementById('mediaUpload').value = '';
      document.getElementById('postCaption').value = '';
      document.getElementById('charCount').textContent = '0/2200 caracteres';
      document.getElementById('uploadId').value = '';
      document.getElementById('uploadInfo').textContent = '';
      currentUploadId = null;
      
      updatePreview();
      showStatus('üóëÔ∏è Contenido limpiado', 'info');
    }

    // Subir contenido al backend
    async function uploadContent() {
      if (uploadedFiles.length === 0) {
        showStatus('‚ùå Selecciona al menos un archivo', 'error');
        return;
      }
      
      const caption = document.getElementById('postCaption').value;
      const sessionId = document.getElementById('sessionId').value || generateSessionId();
      
      // Actualizar sessionId en el input
      document.getElementById('sessionId').value = sessionId;
      currentSessionId = sessionId;
      
      showStatus('üì§ Subiendo contenido al backend...', 'info');
      
      const formData = new FormData();
      uploadedFiles.forEach(file => {
        formData.append('media', file);
      });
      formData.append('caption', caption);
      formData.append('client', currentClient);
      formData.append('session_id', sessionId);
      
      try {
        const response = await fetch(`${API_BASE}/api/media/upload`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Error subiendo contenido');
        }
        
        currentUploadId = data.upload_id;
        
        // Actualizar UI
        document.getElementById('uploadId').value = data.upload_id;
        document.getElementById('uploadInfo').innerHTML = `
          ‚úÖ ${data.media_count} archivo(s) subidos<br>
          <small>ID: ${data.upload_id}</small>
        `;
        
        showStatus(`‚úÖ Contenido subido exitosamente (ID: ${data.upload_id})`, 'success');
        
        // Cambiar a pesta√±a de configuraci√≥n
        setTimeout(() => switchTab('config'), 1000);
        
      } catch (error) {
        console.error('Error subiendo contenido:', error);
        showStatus(`‚ùå Error: ${error.message}`, 'error');
      }
    }

    // Generar session ID
    function generateSessionId() {
      return `sess_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    // Refrescar token
    async function refreshToken() {
      showStatus(`üîÑ Refrescando token para ${currentClient}...`, 'info');
      
      try {
        const response = await fetch(`${API_BASE}/ig/${currentClient}/refresh`);
        const data = await response.json();
        
        document.getElementById('output').textContent = JSON.stringify(data, null, 2);
        showStatus('‚úÖ Token refrescado', 'success');
        
      } catch (error) {
        showStatus(`‚ùå Error refrescando token: ${error.message}`, 'error');
      }
    }

    // Crear campa√±a unificada
    async function crearCampanhaUnificada() {
      if (!currentUploadId) {
        showStatus('‚ùå Primero sube contenido en la pesta√±a "Subir Contenido"', 'error');
        switchTab('upload');
        return;
      }
      
      const uploadId = currentUploadId;
      const caption = document.getElementById('postCaption').value;
      const windowHours = document.getElementById('windowHours').value;
      const objetivo = document.getElementById('objetivo').value;
      const sessionId = document.getElementById('sessionId').value || generateSessionId();
      
      // Obtener valores de segmentaci√≥n
      const geoSelect = document.getElementById('geo');
      const selectedGeo = Array.from(geoSelect.selectedOptions).map(opt => opt.value);
      
      const businessSelect = document.getElementById('businessType');
      const selectedBusiness = Array.from(businessSelect.selectedOptions).map(opt => opt.value);
      
      const ageMin = parseInt(document.getElementById('ageMin').value);
      const ageMax = parseInt(document.getElementById('ageMax').value);
      const ticketMin = parseInt(document.getElementById('ticketMin').value);
      const ticketMax = parseInt(document.getElementById('ticketMax').value);
      
      // Construir constraints
      const constraints = {
        objetivo: objetivo,
        geo: selectedGeo,
        segment: "high_ticket",
        age_range: { min: ageMin, max: ageMax },
        business_type: selectedBusiness,
        revenue_stage: '10k+ mensual',
        experience_level: 'avanzado',
        ticket_min: ticketMin,
        ticket_max: ticketMax,
        platform: 'instagram'
      };
      
      showStatus('üöÄ Creando campa√±a High Ticket...', 'info');
      
      const campaignStatusDiv = document.getElementById('campaignStatus');
      campaignStatusDiv.innerHTML = `
        <div class="status info">
          ‚è≥ Preparando campa√±a para: <strong>${currentClient}</strong><br>
          üìä Objetivo: <strong>${objetivo} ventas</strong><br>
          ‚è∞ Duraci√≥n: <strong>${windowHours} horas</strong><br>
          üåç Regiones: <strong>${selectedGeo.join(', ')}</strong>
        </div>
      `;
      
      try {
        const response = await fetch(`${API_BASE}/api/${currentClient}/campaign`, {
          method: "POST",
          headers: { 
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            session_id: sessionId,
            upload_id: uploadId,
            caption: caption,
            window_hours: parseInt(windowHours),
            constraints: JSON.stringify(constraints)
          })
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        const campaignData = await response.json();
        currentCampaignId = campaignData.campaign_id;
        
        // Mostrar resultados
        displayCampaignResults(campaignData);
        showStatus(`‚úÖ Campa√±a creada exitosamente: ${campaignData.campaign_id}`, 'success');
        
        // Cambiar a pesta√±a de resultados
        setTimeout(() => switchTab('results'), 1000);
        
      } catch (error) {
        console.error('Error creando campa√±a:', error);
        showStatus(`‚ùå Error: ${error.message}`, 'error');
        
        campaignStatusDiv.innerHTML = `
          <div class="status error">
            ‚ùå Error creando campa√±a: ${error.message}
          </div>
        `;
      }
    }

    // Mostrar resultados de la campa√±a
    function displayCampaignResults(data) {
      const output = document.getElementById('output');
      output.textContent = JSON.stringify(data, null, 2);
      
      const statusDiv = document.getElementById('campaignStatusMessage');
      const summaryDiv = document.getElementById('campaignSummary');
      
      // Status message
      statusDiv.innerHTML = `
        <div class="status success">
          ‚úÖ Campa√±a lanzada exitosamente<br>
          <strong>ID:</strong> ${data.campaign_id}<br>
          <strong>Estado:</strong> ${data.status || 'active'}
        </div>
      `;
      
      // Summary si existe
      if (data.post && data.distribution) {
        summaryDiv.innerHTML = `
          <div class="campaign-summary">
            <h3>üéâ ¬°Campa√±a en Progreso!</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <div class="label">Post ID</div>
                <div class="value">${data.post.id ? data.post.id.substring(0, 10) + '...' : 'N/A'}</div>
              </div>
              <div class="summary-item">
                <div class="label">Tipo de Contenido</div>
                <div class="value">${data.post.media_type || 'IMAGE'}</div>
              </div>
              <div class="summary-item">
                <div class="label">Target 24h</div>
                <div class="value">${data.distribution.target_24h ? data.distribution.target_24h.toLocaleString() : '100,000'}</div>
              </div>
              <div class="summary-item">
                <div class="label">Red Activada</div>
                <div class="value">${data.distribution.network_size || 0} nodos</div>
              </div>
              <div class="summary-item">
                <div class="label">Cliente</div>
                <div class="value">${currentClient === 'owner' ? 'Owner' : 'Cliente ' + currentClient.charAt(currentClient.length-1)}</div>
              </div>
              <div class="summary-item">
                <div class="label">Confianza</div>
                <div class="value">${data.distribution.confidence ? (data.distribution.confidence * 100).toFixed(0) + '%' : '85%'}</div>
              </div>
            </div>
            
            ${data.post.url ? `
            <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 8px;">
              <strong>üîó Enlace del Post:</strong><br>
              <a href="${data.post.url}" target="_blank" style="color: #3498db; word-break: break-all;">
                ${data.post.url}
              </a>
            </div>
            ` : ''}
            
            ${data.monitoring ? `
            <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 8px;">
              <strong>üìä Monitoreo:</strong><br>
              <a href="${data.monitoring.dashboard_url || '#'}" target="_blank" style="color: #3498db;">
                ${data.monitoring.dashboard_url || 'Dashboard de m√©tricas'}
              </a>
            </div>
            ` : ''}
          </div>
        `;
      }
    }

    // Verificar estado de la campa√±a
    async function checkCampaignStatus() {
      if (!currentSessionId) {
        showStatus('‚ùå No hay sesi√≥n activa', 'error');
        return;
      }
      
      showStatus('üîÑ Actualizando estado de la campa√±a...', 'info');
      
      try {
        const response = await fetch(`${API_BASE}/api/monitor/${currentSessionId}`);
        const data = await response.json();
        
        document.getElementById('output').textContent = JSON.stringify(data, null, 2);
        showStatus('‚úÖ Estado actualizado', 'success');
        
      } catch (error) {
        showStatus(`‚ùå Error actualizando estado: ${error.message}`, 'error');
      }
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      // Generar session ID por defecto
      const sessionId = generateSessionId();
      document.getElementById('sessionId').value = sessionId;
      currentSessionId = sessionId;
      
      // Inicializar cliente por defecto
      selectClient('owner');
      
      // Mostrar mensaje de bienvenida
      showStatus('‚úÖ Sistema listo. Selecciona contenido y crea tu campa√±a High Ticket!', 'success', 8000);
    });
  </script>
</body>
</html>
